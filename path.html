<!DOCTYPE html>
<html>
<head>
	<title></title>
<style type="text/css">
	.hidden{
		display:none;
	}
</style>
</head>
<body>

<svg width="1640" height='1640'>


<path  id="spline" stroke="#000" fill="none" d="" />

<path stroke="#000" stroke-width="2" fill="none" d="M20,380 R58,342 100,342 100,300 140,250 190,210 220,197 250,184 280,155 310,260 404,20"/>

</svg>

  <script type="text/javascript" src="catmullrom2bezier.js"></script>
  <script type="text/javascript">
    var svgns = "http://www.w3.org/2000/svg";
    var path = document.getElementById("spline");
    var d = "";
    var i = 0;

    window.addEventListener('dblclick',  function(){ hideDot() });
    window.addEventListener('mousemove', setDot )
    window.addEventListener('mouseup', setPath )

    function calcDist (x1,y1,x2,y2) {
    	return Math.sqrt( Math.pow(x2-x1, 2) + Math.pow(y2-y1, 2) );
    }

    function  hideDot (hide) {
      var c = document.querySelectorAll('circle');
      for(var j=0;j<c.length; j++){
        if(typeof hide=='undefined') c[j].classList.toggle('hidden');
        if(hide==false) c[j].classList.remove('hidden');
        if(hide==true) c[j].classList.add('hidden');
      }
    }

    var rPath=[];
    function setDot(evt)
    {
    	if(evt.buttons<1)return;
      var L = rPath.length;
    	if(L && calcDist(rPath[L-1][0], rPath[L-1][1], evt.clientX, evt.clientY)<50 )return;
      var el = document.createElementNS(svgns, "circle");
      el.setAttribute( "cx", evt.clientX );
      el.setAttribute( "cy", evt.clientY );
      el.setAttribute( "r", "3" );
      el.setAttribute( "fill", "red" );
      document.querySelector('svg').appendChild( el );
      
      rPath.push([evt.clientX, evt.clientY]);
    }

    function setPath () {
      var d='';
      for(var i=0; i<rPath.length; i++){
        var p=rPath[i];
        if ( 0 == i ) {
          d = "M" + p[0] + "," + p[1];
        } else if ( 1 == i ) {
          d += " R" + p[0] + "," + p[1];
        } else {
          d += " " + p[0] + "," + p[1];
        }
      }
      path.setAttribute("d", parsePath( d,true ) );
      hideDot(true);
    }

  </script>

</body>
</html>